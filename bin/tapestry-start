#!/usr/bin/env node

'use strict'

const path = require('path')
const fs = require('fs')
const tapestry = require('../dist/server.bundle').default
const logger = require('../dist/logger')
const validator = require('../dist/validator')

const cwd = process.cwd()
const env = 'production'


// project tapestry config path
const configPath = path.join(cwd, 'tapestry.config.js')

logger.info(`Booting Tapestryâ€¦ \n`)

const config = require(configPath)

// validate the config object
validator(config, (sanitizedConfig) =>
  // kick off client build & server
  tapestry.boot({
    config: sanitizedConfig,
    cwd,
    env
  })
)
