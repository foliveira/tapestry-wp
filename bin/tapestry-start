#!/usr/bin/env node

const path = require('path')
const fs = require('fs')
const tapestry = require('../dist/server.bundle').default
const logger = require('../dist/logger')
const validator = require('../dist/validator').default

const cwd = process.cwd()
const env = 'production'


logger.info(`Booting Tapestryâ€¦ \n`)

// project tapestry config path
const configPath = path.join(cwd, '.tapestry', 'app', 'tapestry.config.js')
const config = require(configPath).default

// validate the config object
validator(config, (sanitizedConfig) =>
  // kick off client build & server
  tapestry.boot({
    config: sanitizedConfig,
    cwd,
    env
  })
)
